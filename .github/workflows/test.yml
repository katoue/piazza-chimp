name: Tests

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ['3.9', '3.11']

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install core dependencies
      run: |
        python -m pip install --upgrade pip
        # Install only core deps, skip heavy ML libraries for CI
        pip install python-dotenv anthropic piazza-api

    - name: Test imports (core)
      run: |
        python -c "import bot"
        python -c "import ai_answerer"
        python -c "import piazza_client"
        python -c "import db"
        python -c "import config"

    - name: Test configuration
      run: |
        python -c "
import config
assert hasattr(config, 'POLL_INTERVAL_SEC'), 'Missing POLL_INTERVAL_SEC'
assert hasattr(config, 'MODEL'), 'Missing MODEL'
assert hasattr(config, 'DB_PATH'), 'Missing DB_PATH'
assert hasattr(config, 'CHROMA_DB_PATH'), 'Missing CHROMA_DB_PATH'
print('âœ“ Configuration test passed')
"

    - name: Syntax check
      run: |
        python -m py_compile bot.py
        python -m py_compile ai_answerer.py
        python -m py_compile piazza_client.py
        python -m py_compile db.py
        python -m py_compile config.py
