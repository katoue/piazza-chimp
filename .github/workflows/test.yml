name: Tests

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  syntax-check:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ['3.9', '3.11']

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: Check Python syntax
      run: |
        python -m py_compile bot.py
        python -m py_compile ai_answerer.py
        python -m py_compile piazza_client.py
        python -m py_compile db.py
        python -m py_compile config.py
        python -m py_compile test_answer.py
        echo "✓ All files have valid Python syntax"

    - name: Check configuration file
      run: |
        python -c "
import config
required = ['POLL_INTERVAL_SEC', 'MODEL', 'DB_PATH', 'CHROMA_DB_PATH', 'RAG_TOP_K']
for attr in required:
    assert hasattr(config, attr), f'Missing config: {attr}'
print('✓ Configuration is complete')
"

    - name: Check README and docs
      run: |
        test -f README.md && echo "✓ README.md exists"
        test -f CICD.md && echo "✓ CICD.md exists"
        test -f LICENSE && echo "✓ LICENSE exists"
        test -f requirements.txt && echo "✓ requirements.txt exists"
